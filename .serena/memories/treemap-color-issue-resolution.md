# ツリーマップ色表示問題の解決 (2025年8月10日)

## 問題の概要
- ツリーマップの初期表示で評価済みメッセージの色が正しく表示されない
- メッセージを開くと色が正常に表示される

## 根本原因の特定
デバッグログから発見した実際の問題：

### 症状
```javascript
// 全てのメッセージが同じ青色 #dbeafe になっていた
"childColor": "#dbeafe",
"calculatedColor": "#dbeafe"
```

### 原因
`getMessageColor` 関数の以下のロジックが問題：
```javascript
// 未読メッセージは特別な色（目立つ青色）
if (message.status !== 'read') return '#dbeafe'
```

- `delivered` ステータスのメッセージも `!== 'read'` のため未読扱い
- 評価の有無に関係なく、すべて青色(#dbeafe)で表示される

### 修正内容
条件を具体的なステータスに変更：
```javascript
// 送信済みでない場合（下書き・処理中など）は薄い青色
if (message.status === 'draft' || message.status === 'processing') return '#dbeafe'
```

## 期待される結果
- rating 5 → #ff7f50 (オレンジ)
- rating 4 → #ffb6c1 (ピンク)  
- rating 3 → #fef3c7 (黄色)
- rating 2 → #b0e0e6 (薄い青)
- rating 1 → #87cefa (薄い青)
- 未評価 → #f3f4f6 (薄い灰色)

## デバッグ手法
1. 詳細なコンソールログでデータフローを追跡
2. 初期レンダリングとメッセージ開封後の動作比較
3. 色計算プロセスの各段階での値確認

## 技術的教訓
- ステータス判定では具体的な値での比較が重要
- `!== 'read'` のような否定条件は意図しない副作用を生む可能性
- Vue のリアクティビティ問題ではなく、ビジネスロジック問題だった