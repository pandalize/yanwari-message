# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨å®Ÿè£…å®Œäº†

## ğŸ‰ å®Œæˆã—ãŸã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### Firebase Emulator + MongoDB çµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒ
- **Firebase Authentication Emulator**: http://127.0.0.1:9099
- **Firebase Emulator UI**: http://127.0.0.1:4000/
- **MongoDB Atlas**: å®Œå…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ¶å¾¡
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: Firebase UID â†” MongoDB é€£æº

## ğŸ“‹ å®Ÿè£…å®Œäº†é …ç›®

### 1. Firebase Emulatorè¨­å®š
- âœ… `firebase.json` - Authentication Emulator (port 9099)
- âœ… `.firebaserc` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDè¨­å®š (yanwari-message)
- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ãƒ»å‹•ä½œç¢ºèªæ¸ˆã¿

### 2. MongoDBåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- âœ… `backend/scripts/db-reset.cjs` - å®Œå…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
  - 7ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ (users, messages, friendships, etc.)
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†ä½œæˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - æœ¬ç•ªç’°å¢ƒå®Ÿè¡Œé˜²æ­¢æ©Ÿæ§‹
- âœ… `backend/scripts/db-seed.cjs` - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
  - 3ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ: auth-only, messages, full
  - éšå±¤åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 3. Firebaseçµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- âœ… `backend/scripts/test-firebase-integration.cjs` - çµ±åˆãƒ†ã‚¹ãƒˆ
  - Firebase Emulator ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªå‹•ä½œæˆ
  - MongoDB ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã® UID é€£æºç¢ºèª
  - ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ

### 4. NPMã‚³ãƒãƒ³ãƒ‰çµ±åˆ
```bash
# åŸºæœ¬æ“ä½œ
npm run db:reset              # MongoDBå®Œå…¨ãƒªã‚»ãƒƒãƒˆ
npm run db:seed:full          # å…¨æ©Ÿèƒ½ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run test-env:reset        # MongoDB ãƒªã‚»ãƒƒãƒˆ + ãƒ‡ãƒ¼ã‚¿æŠ•å…¥

# Firebaseçµ±åˆ
npm run test:firebase-integration  # Firebaseçµ±åˆãƒ†ã‚¹ãƒˆ
npm run test-env:full             # å®Œå…¨ç’°å¢ƒèµ·å‹• + ãƒ†ã‚¹ãƒˆ

# ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆåˆ¥æŠ•å…¥
npm run db:seed:auth-only     # èªè¨¼ç”¨æœ€å°ãƒ‡ãƒ¼ã‚¿
npm run db:seed:messages      # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸+å‹é”ãƒ‡ãƒ¼ã‚¿
npm run db:seed:full          # å…¨æ©Ÿèƒ½ãƒ‡ãƒ¼ã‚¿
```

## ğŸ”— ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

### Firebase Authentication (èªè¨¼ã®ã¿)
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
- ID Token æ¤œè¨¼ãƒ»Firebase UID ç”Ÿæˆ

### MongoDB Atlas (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿)
- users, messages, friendships, ratings, schedules, settings
- Firebase UID ã§é€£æº (`firebase_uid` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰)

### é€£æºãƒ•ãƒ­ãƒ¼
```
Firebase ID Token â†’ Firebase Admin SDKæ¤œè¨¼ â†’ Firebase UIDå–å¾—
â†’ MongoDBã€Œfirebase_uidã€ã§æ¤œç´¢ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»æ“ä½œ
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å†…å®¹

### ä½œæˆã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼
1. **Alice ãƒ†ã‚¹ã‚¿ãƒ¼** (alice@yanwari.com)
   - Firebase UID: `test_firebase_uid_001`
   - Password: `testpassword123`
   
2. **Bob ãƒ‡ãƒ¢** (bob@yanwari.com)
   - Firebase UID: `test_firebase_uid_002` 
   - Password: `testpassword123`
   
3. **Charlie ã‚µãƒ³ãƒ—ãƒ«** (charlie@yanwari.com)
   - Firebase UID: `test_firebase_uid_003`
   - Password: `testpassword123`

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
- **å‹é”é–¢ä¿‚**: Alice-Bob, Alice-Charlie
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ç–²åŠ´ãƒ»ä¼šè­°å»¶æœŸã®ã‚„ã‚“ã‚ã‚Šå¤‰æ›æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **è©•ä¾¡**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ (4/5æ˜Ÿ)
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: é…ä¿¡äºˆå®šãƒ‡ãƒ¼ã‚¿
- **è¨­å®š**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãƒ‡ãƒ¼ã‚¿

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### é–‹ç™ºé–‹å§‹æ™‚
```bash
# Firebase Emulatorèµ·å‹•ï¼ˆåˆå›ã®ã¿ï¼‰
firebase emulators:start --only auth &

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç’°å¢ƒæ§‹ç¯‰
npm run test-env:reset

# çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:firebase-integration
```

### æ—¥å¸¸çš„ãªãƒ†ã‚¹ãƒˆ
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿ãƒªã‚»ãƒƒãƒˆï¼ˆFirebase Emulatorèµ·å‹•ä¸­ï¼‰
npm run test-env:reset

# ã¾ãŸã¯å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ
npm run test:firebase-integration
```

## ğŸ¯ è§£æ±ºã—ãŸèª²é¡Œ

### Beforeï¼ˆä»¥å‰ã®å•é¡Œï¼‰
- âŒ ãƒ†ã‚¹ãƒˆæ™‚ã®é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ä¸è¶³
- âŒ æ‰‹å‹•ã§ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
- âŒ é–‹ç™ºè€…é–“ã§ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒå·®ç•°
- âŒ Firebase + MongoDB ã®æ‰‹å‹•é€£æº

### Afterï¼ˆç¾åœ¨ã®è§£æ±ºçŠ¶æ³ï¼‰
- âœ… ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ã§å®Œå…¨ä¸€è‡´ã™ã‚‹ãƒ†ã‚¹ãƒˆç’°å¢ƒ
- âœ… Firebase Emulator ã§ã®å®‰å…¨ãªãƒ†ã‚¹ãƒˆ
- âœ… MongoDB ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨åˆ¶å¾¡
- âœ… è‡ªå‹•åŒ–ã•ã‚ŒãŸçµ±åˆãƒ†ã‚¹ãƒˆ

## ğŸ’¡ é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š

### æ™‚é–“çŸ­ç¸®
- **ãƒ‡ãƒ¼ã‚¿æº–å‚™**: æ‰‹å‹•30åˆ† â†’ è‡ªå‹•30ç§’
- **ç’°å¢ƒçµ±ä¸€**: äººåŠ›èª¿æ•´ â†’ ã‚³ãƒãƒ³ãƒ‰ä¸€ç™º
- **ãƒ†ã‚¹ãƒˆä¿¡é ¼æ€§**: ä¸å®‰å®š â†’ 100%å†ç¾å¯èƒ½

### é–‹ç™ºä½“é¨“
- **ç°¡å˜ãªæ“ä½œ**: `npm run test-env:reset`
- **è¦–è¦šçš„ç¢ºèª**: Firebase Emulator UI
- **ãƒ‡ãƒãƒƒã‚°æ”¯æ´**: è©³ç´°ãƒ­ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†

## ğŸ”§ æŠ€è¡“çš„è©³ç´°

### ä¾å­˜é–¢ä¿‚
- `mongodb ^6.18.0` - MongoDB ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `firebase-admin ^13.4.0` - Firebase Admin SDK
- `dotenv ^17.2.1` - ç’°å¢ƒå¤‰æ•°ç®¡ç†

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- æœ¬ç•ªç’°å¢ƒå®Ÿè¡Œé˜²æ­¢ (`NODE_ENV=production` ãƒã‚§ãƒƒã‚¯)
- ãƒ†ã‚¹ãƒˆç”¨ Firebase UID ä½¿ç”¨
- å®Ÿãƒ‡ãƒ¼ã‚¿ã¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨åˆ†é›¢

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ãƒ»è‡ªå‹•ä½œæˆ
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†å¯¾å¿œ
- ä¸¦è¡Œå‡¦ç†ã§ã®é«˜é€Ÿãƒ‡ãƒ¼ã‚¿æŠ•å…¥

## ğŸŒŸ ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

### ãƒ‡ãƒ¼ã‚¿ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆç”¨ã‚»ãƒƒãƒˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿

### CI/CDçµ±åˆ
- è‡ªå‹•ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- ä¸¦è¡Œãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢
- ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®çµ±åˆãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œ