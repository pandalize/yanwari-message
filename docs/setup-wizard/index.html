<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>セットアップウィザード - アジャイル GitHub スイート</title>
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/enhanced-ui.css">
    <style>
        .wizard-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .step {
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .step.active {
            display: block;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .step-item {
            display: flex;
            align-items: center;
            margin: 0 20px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            transition: all var(--transition-fast);
        }
        
        .step-item.active .step-number {
            background: var(--color-primary);
            color: white;
        }
        
        .step-item.completed .step-number {
            background: var(--color-success);
            color: white;
        }
        
        .step-title {
            font-weight: 500;
            color: var(--color-text-secondary);
        }
        
        .step-item.active .step-title {
            color: var(--color-primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-section {
            background: var(--color-bg-secondary);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
        }
        
        .form-section h3 {
            margin: 0 0 16px 0;
            color: var(--color-text-primary);
        }
        
        .wizard-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border);
        }
        
        .output-section {
            background: var(--color-bg-tertiary);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-top: 20px;
        }
        
        .command-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 16px;
            border-radius: var(--radius-md);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .copy-button {
            position: relative;
            float: right;
            margin-top: -50px;
            margin-right: 10px;
            z-index: 1;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: var(--color-bg-primary);
            padding: 16px;
            border-radius: var(--radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .feature-card:hover {
            border-color: var(--color-primary);
        }
        
        .feature-card.selected {
            border-color: var(--color-primary);
            background: rgba(9, 105, 218, 0.05);
        }
        
        .feature-card h4 {
            margin: 0 0 8px 0;
            color: var(--color-text-primary);
        }
        
        .feature-card p {
            margin: 0;
            font-size: 0.875rem;
            color: var(--color-text-secondary);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <div class="container wizard-container">
        <div class="header">
            <h1>🧙‍♂️ セットアップウィザード</h1>
            <p>あなたのプロジェクトに最適なアジャイル環境を5分でセットアップ</p>
        </div>
        
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step-item active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-title">プロジェクト情報</div>
            </div>
            <div class="step-item" data-step="2">
                <div class="step-number">2</div>
                <div class="step-title">スプリント設定</div>
            </div>
            <div class="step-item" data-step="3">
                <div class="step-number">3</div>
                <div class="step-title">機能選択</div>
            </div>
            <div class="step-item" data-step="4">
                <div class="step-number">4</div>
                <div class="step-title">セットアップ実行</div>
            </div>
        </div>
        
        <!-- Step 1: Project Information -->
        <div class="step active" id="step-1">
            <div class="card">
                <h2>📁 プロジェクト情報</h2>
                
                <div class="form-section">
                    <h3>GitHub リポジトリ</h3>
                    <div class="form-group">
                        <label for="repo-owner" class="form-label">オーガニゼーション/ユーザー名</label>
                        <input type="text" id="repo-owner" class="form-control" placeholder="your-org" required>
                    </div>
                    <div class="form-group">
                        <label for="repo-name" class="form-label">リポジトリ名</label>
                        <input type="text" id="repo-name" class="form-control" placeholder="your-project" required>
                    </div>
                    <div class="form-group">
                        <label for="project-title" class="form-label">プロジェクト表示名</label>
                        <input type="text" id="project-title" class="form-control" placeholder="マイプロジェクト">
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>チーム情報</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="team-name" class="form-label">チーム名</label>
                            <input type="text" id="team-name" class="form-control" placeholder="開発チーム">
                        </div>
                        <div class="form-group">
                            <label for="team-size" class="form-label">チーム規模</label>
                            <select id="team-size" class="form-control">
                                <option value="1-3">小規模 (1-3人)</option>
                                <option value="4-8" selected>中規模 (4-8人)</option>
                                <option value="9-15">大規模 (9-15人)</option>
                                <option value="16+">超大規模 (16人以上)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Sprint Settings -->
        <div class="step" id="step-2">
            <div class="card">
                <h2>🏃‍♂️ スプリント設定</h2>
                
                <div class="form-section">
                    <h3>最初のスプリント</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sprint-name" class="form-label">スプリント名</label>
                            <input type="text" id="sprint-name" class="form-control" value="Sprint 1">
                        </div>
                        <div class="form-group">
                            <label for="sprint-duration" class="form-label">期間（日数）</label>
                            <select id="sprint-duration" class="form-control">
                                <option value="7">1週間 (7日)</option>
                                <option value="10">1.5週間 (10日)</option>
                                <option value="14" selected>2週間 (14日)</option>
                                <option value="21">3週間 (21日)</option>
                                <option value="30">1ヶ月 (30日)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sprint-goal" class="form-label">スプリントゴール（オプション）</label>
                        <textarea id="sprint-goal" class="form-control" rows="2" placeholder="このスプリントで達成したい目標を入力"></textarea>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>スプリント運用設定</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="standup-time" class="form-label">デイリースタンドアップ時間</label>
                            <input type="time" id="standup-time" class="form-control" value="09:00">
                        </div>
                        <div class="form-group">
                            <label for="planning-day" class="form-label">スプリントプランニング日</label>
                            <select id="planning-day" class="form-control">
                                <option value="monday" selected>月曜日</option>
                                <option value="tuesday">火曜日</option>
                                <option value="wednesday">水曜日</option>
                                <option value="thursday">木曜日</option>
                                <option value="friday">金曜日</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Feature Selection -->
        <div class="step" id="step-3">
            <div class="card">
                <h2>⚡ 機能選択</h2>
                
                <div class="form-section">
                    <h3>基本機能（必須）</h3>
                    <div class="feature-grid">
                        <div class="feature-card selected" data-feature="labels">
                            <h4>🏷️ ラベルシステム</h4>
                            <p>優先度・種類・見積もり・状態ラベル</p>
                        </div>
                        <div class="feature-card selected" data-feature="templates">
                            <h4>📋 Issue テンプレート</h4>
                            <p>User Story・Bug Report・Task</p>
                        </div>
                        <div class="feature-card selected" data-feature="milestones">
                            <h4>🎯 マイルストーン</h4>
                            <p>スプリント期間とゴール管理</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>高度な機能（オプション）</h3>
                    <div class="feature-grid">
                        <div class="feature-card selected" data-feature="burndown">
                            <h4>📊 バーンダウンチャート</h4>
                            <p>自動進捗追跡・ベロシティ計算</p>
                        </div>
                        <div class="feature-card selected" data-feature="dashboard">
                            <h4>👥 チームダッシュボード</h4>
                            <p>リアルタイムメトリクス表示</p>
                        </div>
                        <div class="feature-card" data-feature="discord">
                            <h4>🔔 Discord通知</h4>
                            <p>進捗・アラート自動通知</p>
                        </div>
                        <div class="feature-card" data-feature="automation">
                            <h4>🤖 高度な自動化</h4>
                            <p>カスタムワークフロー・統合</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 4: Setup Execution -->
        <div class="step" id="step-4">
            <div class="card">
                <h2>🚀 セットアップ実行</h2>
                
                <div class="form-section">
                    <h3>生成されたコマンド</h3>
                    <p>以下のコマンドをコピーして、ターミナルで実行してください：</p>
                    
                    <div class="command-output" id="generated-command">
                        # コマンドが生成されます...
                    </div>
                    <button class="btn btn--primary copy-button" onclick="copyCommand()">📋 コピー</button>
                </div>
                
                <div class="form-section">
                    <h3>セットアップ後の確認事項</h3>
                    <div class="alert alert--info">
                        <h4>✅ 完了後にチェック:</h4>
                        <ul>
                            <li id="check-pages">GitHub Pages が有効になっている</li>
                            <li id="check-labels">ラベルが正しく作成されている</li>
                            <li id="check-milestone">マイルストーンが作成されている</li>
                            <li id="check-templates">Issue テンプレートが利用可能</li>
                            <li id="check-actions">GitHub Actions が動作している</li>
                        </ul>
                    </div>
                </div>
                
                <div class="output-section">
                    <h3>📊 あなたのダッシュボード URLs</h3>
                    <div id="dashboard-urls">
                        <!-- URLsが生成されます -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="wizard-actions">
            <button class="btn" id="prev-btn" onclick="prevStep()" style="display: none;">← 前へ</button>
            <button class="btn btn--primary" id="next-btn" onclick="nextStep()">次へ →</button>
            <button class="btn btn--primary" id="finish-btn" onclick="finishSetup()" style="display: none;">🎉 完了</button>
        </div>
    </div>
    
    <script src="../assets/js/utils.js"></script>
    <script>
        let currentStep = 1;
        let config = {};
        
        function updateStepIndicator() {
            document.querySelectorAll('.step-item').forEach((item, index) => {
                const stepNum = index + 1;
                if (stepNum < currentStep) {
                    item.classList.add('completed');
                    item.classList.remove('active');
                } else if (stepNum === currentStep) {
                    item.classList.add('active');
                    item.classList.remove('completed');
                } else {
                    item.classList.remove('active', 'completed');
                }
            });
        }
        
        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            
            // Update navigation buttons
            document.getElementById('prev-btn').style.display = step > 1 ? 'block' : 'none';
            document.getElementById('next-btn').style.display = step < 4 ? 'block' : 'none';
            document.getElementById('finish-btn').style.display = step === 4 ? 'block' : 'none';
            
            updateStepIndicator();
            
            if (step === 4) {
                generateCommand();
                generateUrls();
            }
        }
        
        function nextStep() {
            if (validateCurrentStep()) {
                collectStepData();
                currentStep++;
                showStep(currentStep);
            }
        }
        
        function prevStep() {
            currentStep--;
            showStep(currentStep);
        }
        
        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    return document.getElementById('repo-owner').value && 
                           document.getElementById('repo-name').value;
                case 2:
                    return document.getElementById('sprint-name').value;
                case 3:
                    return true; // Features are optional
                default:
                    return true;
            }
        }
        
        function collectStepData() {
            switch(currentStep) {
                case 1:
                    config.repoOwner = document.getElementById('repo-owner').value;
                    config.repoName = document.getElementById('repo-name').value;
                    config.projectTitle = document.getElementById('project-title').value || config.repoName;
                    config.teamName = document.getElementById('team-name').value || 'チーム';
                    config.teamSize = document.getElementById('team-size').value;
                    break;
                case 2:
                    config.sprintName = document.getElementById('sprint-name').value;
                    config.sprintDuration = document.getElementById('sprint-duration').value;
                    config.sprintGoal = document.getElementById('sprint-goal').value;
                    config.standupTime = document.getElementById('standup-time').value;
                    config.planningDay = document.getElementById('planning-day').value;
                    break;
                case 3:
                    config.features = [];
                    document.querySelectorAll('.feature-card.selected').forEach(card => {
                        config.features.push(card.dataset.feature);
                    });
                    break;
            }
        }
        
        function generateCommand() {
            const repo = `${config.repoOwner}/${config.repoName}`;
            const sprint = config.sprintName;
            const days = config.sprintDuration;
            
            let command = `# アジャイル GitHub スイート セットアップ\n\n`;
            command += `# 1. リポジトリをクローン\n`;
            command += `git clone https://github.com/pandalize/agile.git\n`;
            command += `cd agile\n\n`;
            command += `# 2. セットアップスクリプト実行\n`;
            command += `./scripts/setup-enhanced.sh -r "${repo}" -s "${sprint}" -d ${days}`;
            
            if (!config.features.includes('templates')) {
                command += ' --skip-issues';
            }
            
            command += `\n\n# 3. GitHub Pages 有効化\n`;
            command += `# リポジトリの Settings → Pages → Source: Deploy from branch (main, /docs)\n\n`;
            command += `# 4. プロジェクト情報をカスタマイズ\n`;
            command += `# docs/assets/js/utils.js の REPO_OWNER, REPO_NAME を更新`;
            
            document.getElementById('generated-command').textContent = command;
        }
        
        function generateUrls() {
            const owner = config.repoOwner;
            const repo = config.repoName;
            
            let urlsHtml = '';
            if (config.features.includes('burndown')) {
                urlsHtml += `<p><strong>📊 バーンダウンチャート:</strong><br>`;
                urlsHtml += `<a href="https://${owner}.github.io/${repo}/burndown/" target="_blank">https://${owner}.github.io/${repo}/burndown/</a></p>`;
            }
            
            if (config.features.includes('dashboard')) {
                urlsHtml += `<p><strong>👥 チームダッシュボード:</strong><br>`;
                urlsHtml += `<a href="https://${owner}.github.io/${repo}/team-dashboard/" target="_blank">https://${owner}.github.io/${repo}/team-dashboard/</a></p>`;
            }
            
            urlsHtml += `<p><strong>📋 GitHub リポジトリ:</strong><br>`;
            urlsHtml += `<a href="https://github.com/${owner}/${repo}" target="_blank">https://github.com/${owner}/${repo}</a></p>`;
            
            document.getElementById('dashboard-urls').innerHTML = urlsHtml;
        }
        
        function copyCommand() {
            const command = document.getElementById('generated-command').textContent;
            navigator.clipboard.writeText(command).then(() => {
                const btn = document.querySelector('.copy-button');
                const originalText = btn.textContent;
                btn.textContent = '✅ コピー済み';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }
        
        function finishSetup() {
            window.location.href = '../';
        }
        
        // Feature card selection
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.feature-card').forEach(card => {
                card.addEventListener('click', function() {
                    // Don't allow deselecting required features
                    if (this.dataset.feature === 'labels' || 
                        this.dataset.feature === 'templates' || 
                        this.dataset.feature === 'milestones') {
                        return;
                    }
                    this.classList.toggle('selected');
                });
            });
        });
    </script>
</body>
</html>