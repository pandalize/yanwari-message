# やんわり伝言アプリ - 実機テストガイド

このガイドでは、やんわり伝言アプリを実機でテストする手順を説明します。

## 前提条件

- macOS（iOS実機テスト用）
- Xcode 15.0以上
- iOS Developer Account（実機インストール用）
- iPhone/iPad実機（iOS 16.0以上推奨）

## 実機テスト手順

### 1. 開発サーバーの起動

まず、バックエンドとフロントエンドの開発サーバーを起動します：

```bash
# ターミナル1: バックエンドサーバー起動
cd backend
go run main.go

# ターミナル2: フロントエンドサーバー起動（開発用）
cd frontend
npm run dev
```

### 2. ネットワーク設定の確認

実機からバックエンドAPIにアクセスするため、ローカルIPアドレスを確認してください：

```bash
# macOSでローカルIPアドレスを確認
ifconfig | grep "inet " | grep -v 127.0.0.1
```

例：`192.168.1.100` などのIPアドレスをメモしてください。

### 3. Capacitor設定の更新

`frontend/capacitor.config.ts` ファイルで、実際のIPアドレスを設定：

```typescript
server: {
  allowNavigation: [
    'http://192.168.1.100:8080', // あなたのローカルIPアドレス
    'http://localhost:8080',
    'https://yanwari-message.firebaseapp.com'
  ]
}
```

### 4. アプリのビルドと同期

```bash
cd frontend

# Vue.jsアプリをビルド
npm run build

# Capacitorプロジェクトと同期
npx cap sync ios

# Xcodeでプロジェクトを開く
npx cap open ios
```

### 5. Xcodeでの設定

Xcodeが起動したら、以下の設定を行います：

#### 5.1 Development Teamの設定
1. プロジェクト設定 → `App` ターゲット選択
2. `Signing & Capabilities` タブ
3. `Team` を自分のApple Developer Accountに設定
4. `Bundle Identifier` を一意の名前に変更（例：`com.yourname.yanwari.message`）

#### 5.2 デバイスの設定
1. 実機をUSBケーブルでMacに接続
2. iPhoneで「このコンピュータを信頼しますか？」で「信頼」を選択
3. Xcodeの上部でターゲットデバイスを実機に設定

#### 5.3 ビルドと実行
1. Xcodeで `⌘ + R` を押してビルド・実行
2. 初回実行時は「信頼されていない開発者」エラーが出る場合があります
3. iPhone設定 → 一般 → VPNとデバイス管理 → 開発者アプリ → 信頼

### 6. 実機での動作確認

アプリが起動したら、以下の機能をテストしてください：

#### 6.1 基本機能テスト
- [ ] アプリ起動とスプラッシュスクリーン表示
- [ ] ログイン画面の表示
- [ ] Firebase認証（alice@yanwari.com / password123）
- [ ] ホーム画面への遷移

#### 6.2 メッセージ機能テスト
- [ ] メッセージ作成画面
- [ ] AIトーン変換機能
- [ ] スケジュール設定
- [ ] 送信機能

#### 6.3 受信機能テスト
- [ ] 受信トレイ表示
- [ ] メッセージ詳細表示
- [ ] 評価システム

## トラブルシューティング

### よくある問題と解決方法

#### 1. APIに接続できない
**問題**: アプリからバックエンドAPIにアクセスできない

**解決方法**:
- ローカルIPアドレスが正しく設定されているか確認
- バックエンドサーバーが起動しているか確認
- ファイアウォール設定を確認（ポート8080が開いているか）

#### 2. Firebase認証エラー
**問題**: ログイン時にFirebaseエラーが発生

**解決方法**:
- Firebase Console で認証が有効になっているか確認
- テストユーザーアカウントが作成されているか確認
- ネットワーク接続を確認

#### 3. ビルドエラー
**問題**: Xcodeでビルドが失敗する

**解決方法**:
```bash
# Podfile を再インストール
cd frontend/ios/App
pod install --repo-update

# キャッシュをクリア
npx cap sync ios
```

#### 4. 「信頼されていない開発者」エラー
**解決方法**:
1. iPhone設定アプリを開く
2. 一般 → VPNとデバイス管理
3. 開発者アプリで自分のApple IDを見つける
4. 「信頼」をタップ

## 開発用テストアカウント

実機テスト時は以下のアカウントを使用してください：

- **メールアドレス**: alice@yanwari.com
- **パスワード**: password123

または

- **メールアドレス**: bob@yanwari.com  
- **パスワード**: password123

## パフォーマンステスト

実機でのパフォーマンス確認項目：

- [ ] アプリ起動時間（3秒以内）
- [ ] 画面遷移の滑らかさ
- [ ] AIトーン変換の応答時間（10秒以内）
- [ ] メモリ使用量（100MB以下）
- [ ] バッテリー消費量

## リリース前チェックリスト

- [ ] 全画面での表示確認（iPhone各サイズ）
- [ ] 縦・横画面の対応確認
- [ ] ダークモード対応確認
- [ ] オフライン時の動作確認
- [ ] プッシュ通知テスト（実装後）

---

## 次のステップ

実機テストが完了したら：

1. **TestFlight配信**: Apple Developer Console でTestFlightに配信
2. **App Store審査**: Apple App Store への申請
3. **本番環境対応**: 本番APIサーバーへの接続設定

## サポート

問題が発生した場合は、以下の情報を含めて報告してください：

- デバイス情報（機種、iOSバージョン）
- エラーメッセージ
- 再現手順
- Xcodeのビルドログ